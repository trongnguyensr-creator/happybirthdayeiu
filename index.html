<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
  <title>Happy Birthday, My Love ♡</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Preload ảnh quan trọng -->
  <link rel="preload" href="first_meet.jpg" as="image">
  <link rel="preload" href="first_date.jpg" as="image">

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      font-family: 'Quicksand', system-ui, -apple-system, sans-serif;
      color: #222;
      overflow: hidden;
      background: linear-gradient(135deg, #fff0f5, #ff9fbe, #ff6b98, #ffb8d1);
      background-size: 200% 200%;
      animation: bgFlow 20s ease-in-out infinite;
      touch-action: manipulation;
    }

    @keyframes bgFlow {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* Floating glow - nhẹ hơn trên mobile */
    .floating-glow {
      position: absolute;
      background: radial-gradient(circle at 40% 40%, rgba(255,255,255,0.75) 0%, rgba(255,200,220,0.45) 50%, transparent 80%);
      border-radius: 50%;
      pointer-events: none;
      filter: blur(18px);
      mix-blend-mode: screen;
      z-index: 1;
      opacity: 0.7;
    }

    @media (max-width: 768px) {
      .floating-glow { filter: blur(14px); opacity: 0.6; }
    }

    /* Scene */
    .scene {
      position: absolute;
      inset: 0;
      transition: opacity 0.7s ease-out;
      z-index: 2;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Glass card */
    .glass {
      background: rgba(255,255,255,0.48);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(255,255,255,0.55);
      border-radius: 24px;
      padding: 40px 28px;
      box-shadow: 0 12px 40px rgba(0,0,0,0.16);
      text-align: center;
      max-width: 92%;
      max-height: 82vh;
      overflow: hidden;
    }

    /* Countdown */
    #countdown {
      font-weight: 700;
      font-size: clamp(2.8rem, 9vw, 4.4rem);
      letter-spacing: 8px;
      margin-bottom: 20px;
      color: white;
      text-shadow: 0 0 16px #ff9fc4;
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .time-unit {
      min-width: 78px;
      background: rgba(255,255,255,0.32);
      border-radius: 14px;
      padding: 10px 0;
      backdrop-filter: blur(8px);
    }

    #date {
      font-size: clamp(1.6rem, 5vw, 2.2rem);
      color: white;
      text-shadow: 0 0 12px #ffb3d1;
    }

    /* Timeline */
    #timeline {
      width: 100%;
      height: 100%;
      padding: 4vh 12px;
      overflow-y: auto;
      scroll-behavior: smooth;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 5vh;
    }

    .timeline-card {
      width: 94%;
      max-width: 520px;
      background: rgba(255,255,255,0.94);
      border-radius: 28px;
      padding: 40px 28px;
      box-shadow: 0 10px 35px rgba(0,0,0,0.14);
      opacity: 0;
      transform: translateY(50px);
      transition: all 0.8s ease-out;
    }

    .timeline-card.visible {
      opacity: 1;
      transform: translateY(0);
    }

    .timeline-card img {
      width: 100%;
      border-radius: 18px;
      margin-bottom: 24px;
      display: block;
    }

    .timeline-card h3 {
      font-size: clamp(1.8rem, 5.2vw, 2.3rem);
      color: #d81b60;
      margin-bottom: 16px;
    }

    .memory-text {
      font-size: clamp(1.1rem, 3.8vw, 1.35rem);
      line-height: 1.65;
      color: #333;
    }

    /* Sparkle - nhẹ hơn */
    .sparkle {
      position: absolute;
      width: 6px;
      height: 6px;
      background: white;
      border-radius: 50%;
      pointer-events: none;
      animation: sparkleAnim 1.1s ease-out forwards;
      box-shadow: 0 0 10px white;
    }

    @keyframes sparkleAnim {
      0% { transform: scale(0); opacity: 1; }
      50% { transform: scale(1.7); opacity: 0.9; }
      100% { transform: scale(0); opacity: 0; }
    }

    /* Tôn trọng thiết lập giảm chuyển động */
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        transition-duration: 0.01ms !important;
      }
    }

    /* Mobile tinh chỉnh */
    @media (max-width: 768px) {
      .glass { padding: 32px 22px; border-radius: 20px; }
      #countdown { font-size: clamp(2.4rem, 8vw, 3.6rem); letter-spacing: 6px; }
      .time-unit { min-width: 68px; font-size: 1.3rem; }
      #timeline { padding: 3vh 10px; gap: 4.5vh; }
      .timeline-card { padding: 32px 22px; }
    }
  </style>
</head>
<body>

<!-- Floating glow (giảm còn 4-5 để nhẹ hơn) -->
<div class="floating-glow" style="width:340px;height:340px;left:8%;top:12%;animation-duration:34s;"></div>
<div class="floating-glow" style="width:420px;height:420px;left:88%;top:18%;animation-duration:40s;"></div>
<div class="floating-glow" style="width:280px;height:280px;left:35%;top:78%;animation-duration:28s;"></div>

<audio id="music" src="hpbd.mp3" loop preload="auto"></audio>

<div id="scene1" class="scene">
  <div class="glass">
    <div id="countdown">
      <span class="time-unit" id="hh">23</span>:
      <span class="time-unit" id="mm">59</span>:
      <span class="time-unit" id="ss">55</span>
    </div>
    <div id="date">12/02/2026</div>
  </div>
</div>

<div id="scene2" class="scene" style="opacity:0">
  <div id="timeline">
    <div class="timeline-card">
      <img src="first_meet.jpg" alt="Ngày đầu gặp" loading="lazy">
      <h3>Ngày Đầu Gặp</h3>
      <div class="memory-text" data-original="Lần đầu ánh mắt chạm nhau, tim mình đã biết... đây chính là người mình tìm kiếm bao lâu nay."></div>
    </div>
    <div class="timeline-card">
      <img src="first_date.jpg" alt="Buổi hẹn đầu" loading="lazy">
      <h3>Buổi Hẹn Đầu Tiên</h3>
      <div class="memory-text" data-original="Cả thế giới như ngừng trôi, chỉ còn lại nụ cười và ánh mắt của em."></div>
    </div>
    <div class="timeline-card">
      <img src="anniversary.jpg" alt="Kỷ niệm" loading="lazy">
      <h3>Kỷ Niệm Đẹp</h3>
      <div class="memory-text" data-original="Mỗi ngày bên em đều là một kỷ niệm đáng nhớ nhất trong đời anh."></div>
    </div>
    <div class="timeline-card">
      <img src="future.jpg" alt="Tương lai" loading="lazy">
      <h3>Tương Lai Của Chúng Ta</h3>
      <div class="memory-text" data-original="Còn rất nhiều ngày đẹp trời đang chờ chúng mình cùng nhau viết tiếp..."></div>
    </div>
  </div>
</div>

<script>
// Music bật khi tương tác (tốt cho iOS)
const audio = document.getElementById('music');
document.addEventListener('touchend', function enableAudio() {
  audio.muted = false;
  audio.volume = 0.38;
  audio.play().catch(()=>{});
  document.removeEventListener('touchend', enableAudio);
}, { once: true });

// Countdown
const hh = document.getElementById('hh');
const mm = document.getElementById('mm');
const ss = document.getElementById('ss');
const dateEl = document.getElementById('date');

let h = 23, m = 59, s = 55;

function pad(n) { return n < 10 ? '0' + n : n; }

function updateDisplay() {
  hh.textContent = pad(h);
  mm.textContent = pad(m);
  ss.textContent = pad(s);
}

function createSparkle(x, y) {
  const sp = document.createElement('div');
  sp.className = 'sparkle';
  sp.style.left = x + 'px';
  sp.style.top = y + 'px';
  sp.style.setProperty('--x', (Math.random()*80 - 40) + 'px');
  sp.style.setProperty('--y', (Math.random()*80 - 40) + 'px');
  document.body.appendChild(sp);
  setTimeout(() => sp.remove(), 1100);
}

function nextSecond() {
  s++;
  if (s >= 60) { s = 0; m++; if (m >= 60) { m = 0; h++; } }
  updateDisplay();

  if (h === 23 && m === 59 && s === 59) {
    dateEl.classList.add('date-glow');
    dateEl.textContent = '13/02/2026';

    const rect = dateEl.getBoundingClientRect();
    const cx = rect.left + rect.width / 2;
    const cy = rect.top + rect.height / 2;

    for (let i = 0; i < 8; i++) {
      setTimeout(() => createSparkle(cx, cy), i * 45);
    }

    document.getElementById('scene1').style.opacity = '0';
    setTimeout(() => {
      document.getElementById('scene2').style.opacity = '1';
      setTimeout(() => {
        scrollToCard(0);
        setTimeout(startAutoScroll, 4200);
      }, 700);
    }, 800);

    clearInterval(timer);
  }
}

updateDisplay();
const timer = setInterval(nextSecond, 1000);

// Typewriter
function typeWriter(el, text, speed = 42) {
  el.innerHTML = '';
  let i = 0;
  function type() {
    if (i < text.length) {
      el.innerHTML += text.charAt(i++);
      setTimeout(type, speed);
    }
  }
  type();
}

// Timeline
const cards = document.querySelectorAll('.timeline-card');
const SHOW_TIME = 7800;
const FADE_TIME = 1400;
let autoScrollInterval = null;
let isUserScrolling = false;

function scrollToCard(index) {
  const card = cards[index];
  card.classList.add('visible');

  const textEl = card.querySelector('.memory-text');
  if (textEl && textEl.dataset.original) {
    typeWriter(textEl, textEl.dataset.original);
  }

  card.scrollIntoView({
    behavior: 'smooth',
    block: 'center',
    inline: 'nearest'
  });
}

function startAutoScroll() {
  let current = 0;
  autoScrollInterval = setInterval(() => {
    if (isUserScrolling) return;

    const currentCard = cards[current];
    currentCard.classList.remove('visible');

    setTimeout(() => {
      current = (current + 1) % cards.length;
      scrollToCard(current);
    }, FADE_TIME);
  }, SHOW_TIME + FADE_TIME);
}

// Phát hiện scroll tay
const timeline = document.getElementById('timeline');
timeline.addEventListener('scroll', () => {
  isUserScrolling = true;
  clearTimeout(window.scrollTimer);
  window.scrollTimer = setTimeout(() => { isUserScrolling = false; }, 18000);
});

timeline.addEventListener('touchmove', () => {
  isUserScrolling = true;
  clearTimeout(window.scrollTimer);
  window.scrollTimer = setTimeout(() => { isUserScrolling = false; }, 18000);
});
</script>
</body>
</html>
